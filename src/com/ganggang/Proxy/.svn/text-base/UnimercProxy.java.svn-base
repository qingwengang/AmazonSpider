package com.ganggang.Proxy;

import java.io.IOException;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;

import com.ganggang.DO.Online.PriceDO;
import com.ganggang.DO.Online.PriceDetailDO;
import com.ganggang.DO.Unimerc.UnimercPriceDO;
import com.ganggang.Dao.CamelListUrlDao;
import com.ganggang.Factory.A;
import com.ganggang.Thread.CamelUrl;
import com.ganggang.Util.LogHelper;

public class UnimercProxy {
//	public static void main(String[] args) throws IOException{
//		GetPriceById("B00836H2I6");
//	}
	public static void GetPriceById(String id) throws IOException{
		String url=String.format("http://www.unimerc.com/chart_output.php?sku=%s", id);
		Document doc = Jsoup.connect(url).get();
		String htmlContent=doc.html();
		int firstLocation=htmlContent.indexOf('{');
		int lastLocation=htmlContent.lastIndexOf('}')+1;
		String jsonData=htmlContent.substring(firstLocation,lastLocation );
		System.out.println(jsonData);
	}
	
	public static void GetPriceById(CamelUrl camelUrl) throws IOException{
		Document doc = camelUrl.getDoc();
		String htmlContent=doc.html();
		int firstLocation=htmlContent.indexOf('{');
		int lastLocation=htmlContent.lastIndexOf('}')+1;
		String jsonData=htmlContent.substring(firstLocation,lastLocation );
		camelUrl.getCamelListUrl().setUnimercPrice(jsonData);
		camelUrl.getCamelListUrl().setUnimercPriceFlag(1);
		CamelListUrlDao.Update(camelUrl.getCamelListUrl());
	}
	public static void GetBasicData(CamelUrl camelUrl){
		
		Document doc=camelUrl.getDoc();
		String htmlContent=doc.html();
		int firstLocation=htmlContent.indexOf('{');
		int lastLocation=htmlContent.lastIndexOf('}')+1;
		String jsonData=htmlContent.substring(firstLocation,lastLocation );
		String priceData=jsonData.replaceAll("&quot;", "\"").replaceAll("\\[\\[", "\\[").replaceAll("\\]\\]", "\\]");
		System.out.println(priceData);
		try{
		JSONObject obj=JSONObject.fromObject(priceData);
		UnimercPriceDO emp=(UnimercPriceDO) JSONObject.toBean(obj,UnimercPriceDO.class);
        System.out.println(emp.getAmazon().size());
        PriceDO priceDo=new PriceDO();
        if(emp.getAmazon().size()>0){
        	for(int i=0;i<emp.getAmazon().size();i++){
        		JSONArray ja1 = emp.getAmazon().getJSONArray(i);
        		Long d1 = ja1.getLong(0);
        		double d2 = ja1.getDouble(1);
                priceDo.getAmazonPrices().add(new PriceDetailDO(d1,d2));
        	}
        	if(emp.getThird().size()>0){
        		for(int i=0;i<emp.getThird().size();i++){
        			JSONArray ja1 = emp.getThird().getJSONArray(i);
            		Long d1 = ja1.getLong(0);
            		double d2 = ja1.getDouble(1);
                    priceDo.getThirdPartyPrice().add(new PriceDetailDO(d1,d2));
        		}
        	}
        	JSONArray jsonArray = JSONArray.fromObject( priceDo);  
        	String onlineData=jsonArray.toString();
        	camelUrl.getCamelListUrl().setUnimercPrice(jsonArray.toString());
        	camelUrl.getCamelListUrl().setUnimercPriceFlag(100);
        	CamelListUrlDao.Update(camelUrl.getCamelListUrl());
        }
		}catch(Exception ex){
			camelUrl.getCamelListUrl().setUnimercPriceFlag(2);
			CamelListUrlDao.Update(camelUrl.getCamelListUrl());
			LogHelper.AddLog("UnimercProxy.GetBasicData", priceData+ex.getStackTrace());
		}
	}
	
	public static void main(String[] args){
		String priceData="{ \"amazon\" : [[1338697097000,16.09],[1339114685000,16.09],[1339161505000,16.09],[1339251479000,16.09],[1339369702000,16.09],[1339455990000,16.09],[1339504255000,16.09],[1339571902000,16.09],[1339791814000,16.09],[1340399369000,16.09],[1340431695000,16.09],[1341170355000,15.27],[1341386245000,15.27],[1341943416000,15.27],[1342735526000,15.56],[1344346238000,15.56],[1345746165000,16.09],[1345822060000,16.09],[1345976225000,15.56],[1346436896000,16.09],[1346516102000,16.09],[1346638740000,15.56],[1346718342000,15.56],[1347541511000,15.56],[1349207476000,16.09],[1349773417000,15.56],[1349906146000,15.55],[1350646070000,15.56],[1350859434000,15.56],[1351274979000,15.56],[1351482583000,15.56],[1352210323000,15.56],[1352463979000,15.55],[1352488903000,15.55],[1352529049000,15.56],[1352596261000,15.56],[1353102659000,15.22],[1353128032000,15.22],[1353232013000,15.56],[1353257566000,15.56],[1353794629000,15.56],[1354468525000,15.56],[1354742509000,15.56],[1356121517000,15.56],[1356142989000,15.56],[1356434337000,15.56],[1357767446000,15.56],[1357940035000,15.56],[1358179753000,15.56],[1358414209000,15.56],[1359054210000,15.56],[1359231156000,15.56],[1359316621000,15.56],[1359696812000,15.56],[1359781981000,16.89],[1360277318000,15.56],[1364810174000,16.19],[1364969967000,16.95],[1365000984000,17.67],[1365007669000,17.26],[1365033535000,17.22],[1365046264000,17.26],[1365103665000,17.67],[1365221120000,16.95],[1365302820000,17.67],[1365553871000,17.71],[1365615661000,17.18],[1365704338000,16.97],[1365734508000,16.97],[1365808292000,16.77],[1365883732000,17.71],[1365959185000,17.71],[1366163906000,17.1],[1366245350000,17.1],[1366617425000,15.76],[1366986275000,15.76],[1367011557000,16.9],[1367633238000,16.29],[1368067555000,16.29],[1368207234000,16.29],[1368276324000,16.29],[1369430060000,16.29],[1369987567000,16.29],[1370269093000,16.29],[1370360058000,16.29],[1370465579000,16.29],[1370608160000,16.29],[1370695058000,16.29],[1370855910000,16.29],[1371503683000,16.29],[1371605642000,16.29],[1371881836000,16.29],[1372059537000,16.29],[1372424540000,16.29],[1372602070000,16.29],[1372696391000,16.29],[1373225695000,16.28],[1373482105000,14.53],[1373652421000,14.53],[1373902513000,16.29],[1374179595000,16.87],[1374273689000,16.87],[1374718005000,16.87],[1374813234000,16.87],[1374985751000,16.89],[1375249410000,16.33],[1375343468000,16.33],[1375521168000,16.29],[1376047417000,16.24],[1377108713000,16.22],[1377727716000,16.22],[1377997335000,16.28],[1378342255000,16.29],[1378593247000,16.28],[1379110463000,16.28],[1379367258000,16.58],[1379635582000,16.58],[1379754566000,16.58],[1379908035000,16.58],[1380172811000,16.57],[1380432350000,16.55],[1380744115000,16.55],[1380835924000,16.55],[1381012291000,16.55],[1381282045000,16.55],[1381562055000,16.96],[1382001059000,16.96],[1382090314000,16.94],[1382263117000,16.94],[1382536243000,16.49],[1383066070000,16.19],[1383158604000,16.49],[1383329403000,16.48],[1383681057000,16.76],[1383856667000,16.48],[1384153197000,16.65],[1384258871000,16.7],[1385040458000,16.3],[1385139179000,16.61],[1385312535000,16.6],[1385953650000,16.6],[1386138107000,15.27],[1386235627000,15.27],[1386412523000,16.16],[1386503153000,16.54],[1386683622000,15.47],[1386959744000,15.82],[1387051008000,16.11],[1387222506000,17.17],[1387314032000,16.11],[1387685767000,16.4],[1388244289000,16.4],[1388812803000,16.4],[1388931158000,16.59],[1389239738000,16.59],[1389436822000,16.59],[1389877919000,17.17],[1390158749000,16.59],[1390255076000,17.17],[1390961477000,17.17],[1391244246000,17.17],[1391525711000,16.59],[1391806733000,17.17],[1392074217000,15.27],[1392188358000,15.27],[1392372064000,15.26],[1392468107000,15.26],[1392649831000,15.26],[1392921178000,17.21],[1393019147000,15.26],[1393203396000,15.26],[1393609999000,15.26],[1394170908000,15.26],[1394812972000,15.26],[1394911364000,17.17],[1395421196000,17.17],[1395545505000,17.17],[1396867634000,17.09],[1397000715000,16.19],[1397266131000,17.17],[1397634241000,16.19],[1398213153000,16.19],[1398431531000,16.19],[1398998185000,16.19],[1399365398000,16.19],[1399698519000,15.89],[1400017506000,15.88],[1400881185000,15.88],[1401761504000,16.94],[1401918767000,16.94],[1402230604000,15.87],[1403425162000,15.86],[1404883944000,17.17],[1405423704000,17.17],[1408550318000,17.82],[1409288650000,17.37],[1409535080000,17.17],[1409836699000,17.16],[1410813969000,18.28],[1411136340000,19.3],[1411782980000,19.46],[1412611303000,17.42],[1413290655000,17.42],[1414204936000,17.42],[1415101129000,17.16],[1415761511000,17.16],[1415779104000,17.16]], \"is_amazon\" : [1],\"third\" : [[1338697097000,11.94],[1339114685000,16.09],[1339161505000,16.09],[1339251479000,16.09],[1339369702000,16.09],[1339455990000,16.09],[1339504255000,16.09],[1339571902000,16.09],[1339791814000,16.09],[1340399369000,16.09],[1340431695000,16.09],[1341170355000,15.27],[1341386245000,15.27],[1341943416000,15.27],[1342735526000,15.56],[1344346238000,15.56],[1345746165000,16.09],[1345822060000,16.09],[1345976225000,15.56],[1346436896000,16.09],[1346516102000,16.09],[1346638740000,15.56],[1346718342000,15.56],[1347541511000,15.56],[1349207476000,16.09],[1349773417000,15.56],[1349906146000,15.55],[1350646070000,15.56],[1350859434000,15.56],[1351274979000,15.56],[1351482583000,15.56],[1352210323000,15.56],[1352463979000,15.55],[1352488903000,15.55],[1352529049000,15.56],[1352596261000,15.56],[1353102659000,15.22],[1353128032000,15.22],[1353232013000,15.56],[1353257566000,15.56],[1353794629000,15.56],[1354468525000,15.56],[1354742509000,15.56],[1356121517000,15.56],[1356142989000,15.56],[1356434337000,15.56],[1357767446000,15.56],[1357940035000,15.56],[1358179753000,15.56],[1358414209000,15.56],[1359054210000,15.56],[1359231156000,15.56],[1359316621000,15.56],[1359696812000,15.56],[1359781981000,16.89],[1360277318000,15.56],[1364810174000,16.19],[1364969967000,16.95],[1365000984000,17.67],[1365007669000,17.26],[1365033535000,17.22],[1365046264000,17.26],[1365103665000,17.67],[1365221120000,16.95],[1365302820000,17.67],[1365553871000,14.62],[1365615661000,14.62],[1365704338000,14.62],[1365734508000,12.22],[1365808292000,12.22],[1365883732000,12.22],[1365959185000,14.62],[1366163906000,12.99],[1366245350000,17.1],[1366617425000,15.76],[1366986275000,15.76],[1367011557000,16.9],[1367633238000,16.29],[1368067555000,16.29],[1368207234000,16.29],[1368276324000,16.29],[1369430060000,16.29],[1369987567000,10.66],[1370269093000,10.66],[1370360006000,10.66],[1370360058000,10.66],[1370465541000,10.66],[1370465579000,10.66],[1370608112000,10.66],[1370608160000,10.66],[1370695039000,14.62],[1370695058000,14.62],[1370855865000,10.66],[1370855910000,10.66],[1371503683000,12.99],[1371605642000,10.66],[1371881836000,10.66],[1372059537000,10.61],[1372424540000,10.61],[1372602070000,10.49],[1372696391000,10.61],[1373137156000,10.41],[1373225695000,10.41],[1373482105000,10.41],[1373652421000,10.41],[1373902513000,10.31],[1374179595000,10.7],[1374273689000,10.7],[1374718005000,10.61],[1374813234000,10.61],[1374985751000,10.6],[1375249410000,10.24],[1375343468000,10.31],[1375521168000,10.24],[1376047417000,10.24],[1377108713000,10.24],[1377727716000,10.36],[1377997335000,10.36],[1378342255000,10.36],[1378593247000,10.36],[1379110463000,10.36],[1379367258000,10.36],[1379635582000,10.36],[1379754566000,9.87],[1379908035000,10.36],[1380172811000,10.36],[1380432350000,10.36],[1380744115000,11.17],[1380835924000,12.23],[1381012291000,16.55],[1381282045000,14.39],[1381562055000,14.39],[1382001059000,14.39],[1382090314000,14.39],[1382263117000,12.23],[1382536243000,10.36],[1383066070000,10.36],[1383158604000,10.36],[1383329403000,10.36],[1383681057000,10.36],[1383856667000,10.41],[1384153197000,10.41],[1384258871000,10.41],[1385040458000,10.36],[1385139179000,10.36],[1385312535000,10.36],[1385953650000,10],[1386138107000,10],[1386235627000,9],[1386412523000,9],[1386503153000,9],[1386683622000,9],[1386959744000,10.36],[1387051008000,12.79],[1387222506000,12.86],[1387314032000,10.36],[1387685767000,10.36],[1388244289000,10.36],[1388812803000,10.36],[1388931158000,10.36],[1389239738000,10.36],[1389436822000,10.36],[1389877919000,12.86],[1390158749000,10.36],[1390255076000,12.86],[1390961477000,12.86],[1391244246000,10.36],[1391525711000,10.64],[1391806733000,10.64],[1392074217000,12.86],[1392188358000,12.86],[1392372064000,11.97],[1392468107000,11.97],[1392649831000,12.86],[1392921178000,11.82],[1393019147000,11.82],[1393203396000,9.99],[1393609999000,11.47],[1394170908000,11.47],[1394812972000,8],[1394911364000,11.47],[1395421196000,11.82],[1395545505000,12.86],[1396867634000,12.86],[1397000715000,12.86],[1397266131000,12.86],[1397634241000,12.86],[1398213153000,12.86],[1398431531000,12.86],[1398998185000,12.86],[1399365398000,12.86],[1399698519000,12.86],[1400017506000,12.86],[1400881185000,12.86],[1401761504000,14.95],[1401918767000,14.95],[1402230604000,14.56],[1403425162000,13.44],[1404883944000,14.95],[1405423704000,14.95],[1408550318000,14.95],[1409288650000,14.95],[1409535080000,14.95],[1409836699000,14.95],[1410813969000,14.95],[1411136340000,14.95],[1411782980000,14.95],[1412611303000,14.95],[1413290655000,12],[1414204936000,14.95],[1415101129000,14.95],[1415761511000,14.95],[1415779104000,14.95]], \"is_third\" : [1],\"used\" : [[1338697097000,13.56],[1339114685000,13.67],[1339161505000,12.92],[1339251479000,12.85],[1339369702000,12.9],[1339455990000,12.91],[1339504255000,13.35],[1339571902000,13.52],[1339791814000,14.32],[1340399369000,14.29],[1340431695000,14.32],[1341170355000,14.32],[1341386245000,13.59],[1344346238000,13.85],[1345746165000,13.85],[1345822060000,14.32],[1345976225000,13.85],[1346436896000,13.85],[1346516102000,14.32],[1346638740000,14.32],[1346718342000,13.85],[1350646070000,13.06],[1351274979000,13.85],[1352210323000,13.85],[1352463979000,13.85],[1352488903000,13.84],[1352529049000,13.84],[1352596261000,13.85],[1353102659000,13.85],[1353128032000,13.55],[1353232013000,13.55],[1353257566000,13.85],[1354468525000,13.25],[1356121517000,13.71],[1356434337000,13.25],[1357767446000,13.71],[1358179753000,13.71],[1359054210000,13.71],[1359316621000,13.71],[1366986275000,13.89],[1367633238000,13.55],[1368207234000,9.79],[1369430060000,13.55],[1369987567000,13.55],[1370695039000,13.55],[1370695058000,13.55],[1371881836000,13.55],[1372059537000,13.55],[1372424540000,8.56],[1372602070000,13.55],[1372696391000,13.55],[1373225695000,10.95],[1373482105000,12.08],[1373652421000,10.95],[1373902513000,10.95],[1374179595000,10.95],[1374813234000,16.58],[1374985751000,16.58],[1379110463000,13.86],[1379367258000,14.12],[1379635582000,7.99],[1379754566000,7.99],[1379908035000,7.99],[1380172811000,7.99],[1380432350000,7.99],[1381012291000,13.76],[1381282045000,13.76],[1381562055000,14.1],[1382263117000,14.09],[1387685767000,10],[1388812803000,14.45],[1388931158000,14.62],[1389239738000,13.8],[1390158749000,13.8],[1390255076000,13.8],[1391244246000,17.15],[1392074217000,12.7],[1392188358000,11.28],[1392372064000,9.46],[1392468107000,11.27],[1392649831000,11.27],[1392921178000,9.46],[1393019147000,11.27],[1393203396000,11.27],[1393609999000,11.27],[1394812972000,12.69],[1394911364000,14.28],[1395421196000,14.28],[1395545505000,14.28],[1396867634000,14.55],[1397000715000,13.78],[1398213153000,14.27],[1398998185000,14.27],[1399365398000,15.88],[1399698519000,15.88],[1400017506000,15.88],[1401918767000,14.93],[1402230604000,13.98],[1403425162000,13.5],[1404883944000,15.14],[1414204936000,14.98],[1415761511000,14.64],[1415779104000,14.64]], \"is_used\" : [1],\"refurb\" : [], \"is_refurb\" : [0]}";
		JSONObject obj=JSONObject.fromObject(priceData);
		UnimercPriceDO emp=(UnimercPriceDO) JSONObject.toBean(obj,UnimercPriceDO.class);
        System.out.println(emp.getAmazon().size());
        PriceDO priceDo=new PriceDO();
        if(emp.getAmazon().size()>0){
        	for(int i=0;i<emp.getAmazon().size();i++){
        		JSONArray ja1 = emp.getAmazon().getJSONArray(i);
        		Long d1 = ja1.getLong(0);
        		double d2 = ja1.getDouble(1);
                priceDo.getAmazonPrices().add(new PriceDetailDO(d1,d2));
        	}
        	if(emp.getThird().size()>0){
        		for(int i=0;i<emp.getThird().size();i++){
        			if(i==206){
        				System.out.println("fds");
        			}
        			JSONArray ja1 = emp.getThird().getJSONArray(i);
            		Long d1 = ja1.getLong(0);
            		double d2 = ja1.getDouble(1);
                    priceDo.getThirdPartyPrice().add(new PriceDetailDO(d1,d2));
        		}
        	}
        }
	}
}